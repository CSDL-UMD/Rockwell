extends ui_layout_no
block content

  //-Change this URI to a CDN you are using for Photos
  -var cdn = "";
  .computer.only.tablet.only.four.wide.column 
    .ui.card
      .image
        if user.profile.picture
          img(src=user.profile.picture)
        else
          img(src=user.gravatar(60))
      .content
        a.header(href='/me')= user.profile.name || user.username || user.id
        .meta="@"+user.username
        .description=user.profile.bio
        .description
          if user.profile.location
            i.marker.icon
            span=user.profile.location
      .one.ui.bottom.attached.icon.buttons
          button.ui.editprofile.button(data-tooltip='Update Your Profile', data-position='bottom left')
            i.write.icon

  #loading.eight.wide.computer.ten.wide.tablet.sixteen.wide.mobile.column
    img.ui.centered.small.image(src='/public/heart.svg')
  #content.eight.wide.computer.ten.wide.tablet.sixteen.wide.mobile.column
    //-.ui.active.dimmer.feed
      .ui.large.text.loader Loading
    //- Input for creating new post at top of feed
    //#newpost.ui.fluid.left.labeled.right.icon.input
    //  .ui.label
    //    if user.profile.picture
    //      img.ui.avatar.image(src='/user_post/'+user.profile.picture)
    //    else
    //      img.ui.avatar.image(src=user.gravatar(60))
    //  input(type='text', placeholder='Share your meal')
    //  i.big.photo.link.icon
    
    -var ii = 0;
    each val in script
      -ii = ii + 1
      -console.log(ii)
      //- create a card for each post in val (if by user make the card a little different)
      //- if val.relativeTime - then post came from user_post (so user post, user reply to actor reply to user post)
      .ui.fluid.card.dim(id="tweet_"+val.post_id,style="display:block;",postID=val.id, state=val.state || 'unread', type='actor', actor_un = val.actor.username, actor_name = val.actor.profile.name, actor_pic = val.actor.profile.picture)
        //- dimmer DIV for flagging
        .ui.dimmer.flag
              .content
                .center
                  h2.ui.inverted.icon.header
                    i.red.flag.icon
                    |  You&apos;ve flagged this!
                    h3.ui.inverted.header
                      span="The admins will review this post further. We are sorry you had this experience."
        //- Normal Base Post
        .content
          .right.floated.time.meta= (Date.now() + val.time)
          |  
          //-a(href='/user/'+val.actor.username)
            img.ui.avatar.image(src=cdn+'/profile_pictures/'+val.actor.profile.picture, style="margin-left: -1px; margin-top: -5px; border-radius: 50%; width: 48px; height: 48px;")
            span(style="margin-left: 4px; margin-top: 19px; min-width: 85px; height: 17px; font-family: HelveticaNeue; font-size: 16px; font-weight: 500; font-style: normal; font-stretch: normal; line-height: normal; letter-spacing: -0.6px; color: #000000;")=val.actor.profile.name
            span(style="margin-left: 4px; margin-top: 19px; min-width: 85px; height: 17px; font-family: HelveticaNeue; font-size: 16px; font-weight: 500; font-style: normal; font-stretch: normal; line-height: normal; letter-spacing: -0.6px; color: #909090;")="@"+val.actor.username
          a(href=val.actor.username)     
            //Change the line above to val.actor.profile.picture since it is a link now ?????????????? ______-----______-----_____------______----
            img.ui.avatar.image.lazyload(data-src=val.actor.profile.picture, style="margin-left: -1x; margin-top: -5px; border-radius: 50%; width: 48px; height: 48px;")
            span(style="margin-left: 4px; margin-top: 19px; min-width: 85px; height: 17px; font-family: HelveticaNeue; font-size: 16px; font-weight: 500; font-style: normal; font-stretch: normal; line-height: normal; letter-spacing: -0.6px; color: #000000;")=val.actor.profile.name
            span(style="margin-left: 4px; margin-top: 19px; min-width: 85px; height: 17px; font-family: HelveticaNeue; font-size: 16px; font-weight: 500; font-style: normal; font-stretch: normal; line-height: normal; letter-spacing: -0.6px; color: #909090;")="@"+val.actor.username
        //-div(style="position: relative; z-index: 1;")
          img(src="image.png" style="position: absolute; z-index: 2;")
          span#overlay_text(style="position: relative; top: -10px; z-index: 3;") OVERLAY
        .content
          .description(style="margin-left: -8px; margin-bottom: -24px; width: 445px; height: 88px; font-family: HelveticaNeue; font-size: 16px; font-weight: 300;font-style: normal; font-stretch: normal; line-height: normal; letter-spacing: -0.6px; color: #000000;")=val.body
            if val.urls.length > 0
              a(href=val.urls)=" "+val.urls
        // Inserting loop for media here --------______----------________---------_______--------______--------##########
        //each mediaLink in val.embedded_images
        if val.embedded_images.length > 0
          //.img.post
          //img.lazyload(data-src=val.embedded_images, style="max-width:100%;width:100%;")
          img(src=val.embedded_images, style="max-width:100%;width:100%;max-height:100%;height:100%")
          //iframe(type='text/html', style="overflow:hidden;width:100%;height:200%", height="200%", width="100%", frameborder="0", src=val.embedded_images)
        if val.picture.length > 0
          if val.picture_heading.length > 3
            //Place the loop going through embeded images here presumably above the buttons and any articles.
            //.img.post
            a(href=val.urls)
              //img.post(src="/"+val.picture)
              //img(src='/public/picture.svg', data-src="/post_pictures/"+val.picture, style="max-width:100%;width:100%;")
              //img.lazyload(data-src=val.picture, style="max-width:100%;width:100%;height:100%")
              img(src=val.picture, style="max-width:100%;width:100%;max-height:100%;height:100%", id="images")
              //img(src=val.picture) 
              // Not sure what the line above is actually doing... was picture_raw ___________--------________---------________-------_______------ Need forloop to go through embeded_images and add them to the post. Array of links to media.
            if val.picture_heading.length > 0
              .content
                .description(style="font-weight: 1000; text-align: center")=val.picture_heading
            if val.picture_description.length > 0
              .content
                .description=val.picture_description
        .three.ui.bottom.attached.icon.buttons
          .ui.reply.button(tabindex='0',onclick='retweet_clicked(\'' + val.tweet_id + '\')')
            i.reply.icon
            |  Retweet
          a.ui.basic.red.left.pointing.label.count=val.retweets
          //if val.like
          //  .ui.labeled.button(tabindex='0',onclick='like_clicked(\'' + val.tweet_id + '\')')
          //    .ui.red.like.button
          //      i.heart.icon
          //      |  Like
          //    a.ui.basic.red.left.pointing.label=val.likes
          //else
          //  .ui.labeled.button(tabindex='0')
          //    .ui.like.button
          //      i.heart.icon
          //      |  Like
          //    a.ui.basic.red.left.pointing.label.count=val.likes
          .ui.reply.button(tabindex='0',onclick='like_clicked(\'' + val.tweet_id + '\')')
            i.reply.icon
            |  Like
          a.ui.basic.red.left.pointing.label.count=val.likes



    .ui.fluid.card
      .content
        .description
        |  End of Posts for the last 48 hours.

    script.
      topPadding = 0;
      sizeList = [];
      var all_elements = document.getElementsByClassName("fluid");
      margin = all_elements[1].offsetTop;
      topPadding = all_elements[0].clientHeight + 2*margin;
      var i = 1;
      for(i = 1;i<all_elements.length-1;i++){
        var post_element = document.getElementById("tweet_"+i);
        img_elements = post_element.getElementsByTagName('img');
        var height_img = 0;
        if(img_elements.length > 1){
          height_img = img_elements[1].clientWidth * 0.5264;
          console.log("CALCULATED HEIGHT : "+height_img);
        }
        sizeList.push(post_element.clientHeight + margin + height_img);
      }
    script.
      var win = $(window);
      window.addEventListener("scroll", function(){viewCountScrollBased(sizeList,win.scrollTop(),topPadding)});

    br
    br
    br
    br
    br
    br
    br
    br
    br
    br
    br
    br
    br
    br
    br
    br
    br
    br
    br
    br
    br
    br
    br
    br
    br
    br
    br
    br
    br
    br
    br
    br
    br
    br
    br
    br
    .ui.tiny.post.modal()
      i.close.icon
      .header Add a New Post
      .content
        form#postform.ui.feed.form(action='/post/new', method='POST', enctype='multipart/form-data')
          input(type='hidden', name='_csrf', value=_csrf)
          .field
            textarea(rows='2', placeholder='Share your meal', name='body')
          .field.image-upload
            label(for='picinput')
              .image.content
                img#imgInp.ui.fluid.image(src='/public/photo-camera.svg')
            //-input#picinput(type='file', accept='image/*', capture='camera', name='picinput')
            input#picinput(type='file', accept='image/*', name='picinput')
          .ui.error.message
      .actions
        input.ui.green.button(type='submit', name="foo", value='Submit', form='postform')